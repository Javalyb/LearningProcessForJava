并发:

并发与并行的区别:
    并行(反义词:串行): 处理同一个资源的时候，可以把资源拆解多份，让多个程序同时处理;
    并发(反义词:顺序): 处理同一个资源的时候，可以让多个程序交替(无序)处理同一个资源;

保证变量同步可见性:
    1.final;
    2.synchronized(悲观锁): 每个线程都有可能抢到不同的一把锁，必须保证抢到同一把锁(可重入锁，非公平锁(后来居上)，此时另一个线程会被阻塞)才能保证同步性;
        语义规范:
            1.进入同步块前，先清空工作内存中的共享变量，从主内存中重新加载;
            2.解锁前必须把修改的共享变量同步到工作内存中;
        如何做到保证线程安全:
            1.锁机制保护共享资源，只有获得锁的线程才可操作共享资源;
            2.语义规范保证修改共享资源后，会同步到工作内存;
        1.6锁升级: 无锁->偏向锁->轻量级锁—>重量级锁;
    3.volatile: 只能保证引用(引用类型存放的是地址，基本类型存放的是值)的可见性，不能保证引用所指向对象的可见性;
                不能保证原子性(i++);
                让JVM限制多核CPU指令重排(CPU默认并行执行指令，保证程序执行效率);
                只可修饰成员变量;
        语义规范:
            1.使用volatile变量时，必须重新从主内存中加载，并且read，load是连续的;
            2.使用volatile变量后，必须立马同步到主内存中，并且store，write是连续的;

Java内存模型:
    主内存(线程共享): 堆，方法区;
    工作内存(线程私有): 虚拟机栈，本地方法栈，程序计数器;
    1.共享变量必须存放在主内存中;
    2.线程有自己的工作内存，只可操作自己的工作内存;
    3.线程要操作共享变量，必须从主内存中通过同步协议读取到工作内存中，
      改变值后从工作内存通过同步协议同步到主内存;

同步协议8中原子操作:
    原子操作: 不会被线程调度机制打断的操作。这种操作一旦开始，就一直运行到结束，中间不会被切换到另一个线程;
    1.lock(锁定): 将主内存中的变量锁定，为一个线程独占;
    2.unlock(解锁): 将lock加的锁定解除，此时其他的线程可以有机会访问此变量;
    3.read(读取): 作用于主内存变量，将主内存中的变量值读取到工作内存中;
    4.load(载入): 作用于工作内存变量，将read读取的值保存到工作内存中的变量副本中;
    5.use(使用): 作用于工作内存变量，将值传递给线程的代码执行引擎;
    6.assign(赋值): 作用于工作内存变量，将执行引擎处理返回的值重新赋值给变量副本;
    7.store(存储): 作用于工作内存变量，将变量副本的值传送到主内存中;
    8.write(写入): 作用于主内存变量，将store传送过来的值写入到主内存的共享变量中;
1.将一个变量从主内存复制到工作内存要顺序执行read，load操作；
  将变量从工作内存同步回主内存要顺序执行store，write操作；
  只要求顺序执行，不要求连续执行;
2.做了assign操作，必须同步回主内存。不能没做assign操作，同步回主内存;

JVM内存模型:
    堆，方法区，虚拟机栈，本地方法栈，程序计数器;

锁: 互斥锁和自旋锁属于基本锁，其他锁基于这两个锁实现;
?: 可重入锁，非公平锁

按上锁时机:
    悲观锁: 线程访问共享资源时，会先上锁;
        1.互斥锁;
        2.自旋锁;
        3.读写锁(写锁): 由读锁和写锁两部分构成;
            1.读优先锁;
            2.写优先锁;
            3.公平读写锁;
    乐观锁: 先修改资源，再验证资源有没有发生冲突(其他线程有没有修改)。没有冲突，修改完成。有冲突，放弃修改。全程不会加锁;

按锁是否共享:
    独占锁: 一个线程获取锁时，其他线程不能获取锁;
        1.互斥锁;
        2.自旋锁;
        3.读写锁(写锁): 由读锁和写锁两部分构成;
            1.读优先锁;
            2.写优先锁;
            3.公平读写锁;
    共享锁: 多个线程可以共享同一把锁;
        1.读写锁(读锁);

CAS(比较替换): 乐观锁的一种实现
    预期值
    目标值
    替换值
CAS带来的ABA问题:

Atomic类: CAS+自旋操作
    

